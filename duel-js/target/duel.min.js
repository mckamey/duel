/*
 DUEL v0.9.0 http://duelengine.org
 Copyright (c)2006-2012 Stephen M. McKamey.
 Licensed under The MIT License.
*/
var duel=function(n,r,C){function y(a){this.value=a}function l(a){return"function"===typeof a}function k(a){switch(typeof a){case "object":return!a?0:z(a)?2:a instanceof y?5:a instanceof Date?4:3;case "function":return 1;case "undefined":return 0;default:return 4}}function p(){this.value=p.FAST?"":[]}function q(a){z(a)||(a=["",a]);this.value=a}function s(a,b){switch(k(b)){case 2:if(""===b[0])for(var d=1,f=b.length;d<f;d++)s(a,b[d]);else a.push(b);break;case 3:if(1===a.length)a.push(b);else if(d=a[1],
3===k(d))for(f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);else a.splice(1,0,b);break;case 4:""!==b&&(b=""+b,d=a.length-1,0<d&&4===k(a[d])?a[d]+=b:a.push(b));break;case 0:break;default:a.push(b)}}function t(a,b,d,f,c,e){var g=3===k(a[1]);if(a.length===(g?3:2))return m(a[a.length-1],b,d,f,c,e);for(var h=[""],g=g?2:1,j=a.length;g<j;g++)s(h,m(a[g],b,d,f,c,e));return h}function D(a,b,d,f,c,e){for(var g=1,h=a.length;g<h;g++){var j=a[g],i=j[1].test;if(3===k(j[1])&&i&&(l(i)&&(i=i(b,d,f,c)),!i))continue;return t(j,
b,d,f,c,e)}return null}function N(a){if("string"!==typeof a)return a;var b={"&":"&amp;","<":"&lt;",">":"&gt;"};return a.replace(/[&<>]/g,function(a){return b[a]||a})}function O(a){if("string"!==typeof a)return a;var b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;"};return a.replace(/[&<>"]/g,function(a){return b[a]||a})}function E(a,b){var d=b[0]||"",f=b.length,c=1,e,g=P[d];if("!"===d.charAt(0))"!DOCTYPE"===b[0]?a.append("<!DOCTYPE ",b[1],">"):a.append("<\!--",b[1],"--\>");else{if(d){a.append("<",
d);e=b[c];if(3===k(e)){for(var h in e)if(e.hasOwnProperty(h)){var j=e[h];if(F[h.toLowerCase()])if(j)j=h;else continue;0!==k(j)&&(a.append(" ",h),a.append('="',O(j),'"'))}c++}g&&a.append(" /");a.append(">")}for(;c<f;c++)e=b[c],z(e)?E(a,e):a.append(N(e));d&&!g&&a.append("</",d,">")}}function G(a){try{var b=new p;E(b,a);return b.toString()}catch(d){return a=w(d),a instanceof q?G(a.value):""+a}}function u(a){if(a){if("!"===a.charAt(0))return n.createComment("!"===a?"":a.substr(1)+" ")}else{if(n.createDocumentFragment)return n.createDocumentFragment();
a=""}return"style"===a.toLowerCase()&&n.createStyleSheet?n.createStyleSheet():n.createElement(a)}function x(a,b){if(b){var d=(a.tagName||"").toLowerCase();if(8===a.nodeType)3===b.nodeType&&(a.nodeValue+=b.nodeValue);else if("table"===d&&a.tBodies)if(b.tagName)if((d=b.tagName.toLowerCase())&&"tbody"!==d&&"thead"!==d){var f=0<a.tBodies.length?a.tBodies[a.tBodies.length-1]:null;f||(f=u("th"===d?"thead":"tbody"),a.appendChild(f));f.appendChild(b)}else!1!==a.canHaveChildren&&a.appendChild(b);else{if(11===
b.nodeType)for(;b.firstChild;)x(a,b.removeChild(b.firstChild))}else if("style"===d&&n.createStyleSheet)a.cssText=b;else if(!1!==a.canHaveChildren)a.appendChild(b);else if("object"===d&&b.tagName&&"param"===b.tagName.toLowerCase()){try{a.appendChild(b)}catch(c){}try{a.object&&(a.object[b.name]=b.value)}catch(e){}}}}function H(a,b,d){"on"===b.substr(0,2)&&(b=b.substr(2));switch(typeof d){case "function":if(a.addEventListener)a.addEventListener(b,d,!1);else if(l(window.jQuery)&&0!==k(a[b]))if(a=window.jQuery(a),
l(a.on))a.on(b,d);else a.bind(b,d);else if(a.attachEvent&&0!==k(a[b]))a.attachEvent("on"+b,d);else{var f=a["on"+b]||a[b];a["on"+b]=a[b]=!l(f)?d:function(a){return!1!==f.call(this,a)&&!1!==d.call(this,a)}}break;case "string":a["on"+b]=new Function("event",d)}}function I(a){return!!a&&3===a.nodeType&&(!a.nodeValue||!/\S/.exec(a.nodeValue))}function J(a,b){a&&(3===a.nodeType&&b.exec(a.nodeValue))&&(a.nodeValue=a.nodeValue.replace(b,""))}function A(a){if(a){for(;I(a.firstChild);)a.removeChild(a.firstChild);
for(J(a.firstChild,Q);I(a.lastChild);)a.removeChild(a.lastChild);J(a.lastChild,R)}}function K(a,b){var d=a[b];if(d){try{delete a[b]}catch(f){try{a[b]="",a.removeAttribute(b)}catch(c){}}if(!l(d))try{d=new Function(""+d)}catch(e){d=null}}return d}function L(a){if(a){var b=K(a,"$init");b&&b.call(a);(b=K(a,"$load"))?setTimeout(function(){b.call(a);b=a=null},0):b=a=null}}function M(a,b){for(var d=1,f=b.length;d<f;d++){var c=b[d];switch(k(c)){case 2:var e=c[0],c=M(u(e),c);if("html"===e)return A(c),L(c),
c;x(a,c);break;case 4:""!==c&&x(a,n.createTextNode(""+c));break;case 3:if(1===a.nodeType){var e=a,g=c;if(g.name&&n.attachEvent&&!e.parentNode)try{var h=u("<"+e.tagName+' name="'+g.name+'">');e.tagName===h.tagName&&(e=h)}catch(j){}c=void 0;for(c in g)if(g.hasOwnProperty(c)){var i=g[c],l=k(i);if(c&&0!==l)if(c=S[c.toLowerCase()]||c,"style"===c)0!==k(e.style.cssText)?e.style.cssText=i:e.style=i;else if("on"===c.substr(0,2))H(e,c,i),(c=v[c])&&H(e,c,i);else if(!T[c.toLowerCase()]&&(4!==l||"$"===c.charAt(0)||
0!==k(e[c])||0!==k(e[v[c]])))try{e[c]=i,(c=v[c])&&(e[c]=i)}catch(m){if(!("type"===c.toLowerCase()&&"input"===e.tagName.toLowerCase()))throw Error("DOM property "+e.tagName+"."+c+": "+m);}else F[c.toLowerCase()]?i&&(e.setAttribute(c,c),(c=v[c])&&e.setAttribute(c,c)):(e.setAttribute(c,i),(c=v[c])&&e.setAttribute(c,i))}a=e}break;case 5:e=x;g=a;i=c;c=u("div");c.innerHTML=""+i;A(c);if(1===c.childNodes.length)c=c.firstChild;else{for(i=u("");c.firstChild;)i.appendChild(c.firstChild);c=i}e(g,c)}}A(a);L(a);
11===a.nodeType&&1===a.childNodes.length&&(a=a.firstChild);return a}y.prototype.toString=function(){return this.value};var z=Array.isArray||function(a){return a instanceof Array};p.FAST=!(r&&9>r());p.prototype.append=function(a,b,d){p.FAST?null!==a&&(this.value+=a,null!==b&&b!==C&&(this.value+=b,null!==d&&d!==C&&(this.value+=d))):this.value.push.apply(this.value,arguments)};p.prototype.clear=function(){this.value=p.FAST?"":[]};p.prototype.toString=function(){return p.FAST?this.value:this.value.join("")};
var B,m;m=function(a,b,d,f,c,e){switch(k(a)){case 1:return a(b,d,f,c);case 2:var g=a[0]||"";switch(g){case "$for":a:{var h=a[1]||{},g=[""],j;if(h.hasOwnProperty("count")){j=h.count;l(j)&&(j=j(b,d,f,c));h.hasOwnProperty("data")?(h=h.data,l(h)&&(h=h(b,d,f,c))):h=b;for(b=0;b<j;b++)s(g,t(a,h,b,j,null,e))}else{if(h.hasOwnProperty("in")){var i=h["in"];l(i)&&(i=i(b,d,f,c));if(3===k(i)){h=[];for(j in i)i.hasOwnProperty(j)&&h.push(j);b=0;for(j=h.length;b<j;b++)s(g,t(a,i[h[b]],b,j,h[b],e));a=g;break a}h=i}else h=
h.each,l(h)&&(h=h(b,d,f,c));b=k(h);if(2===b){b=0;for(j=h.length;b<j;b++)s(g,t(a,h[b],b,j,null,e))}else 0!==b&&(g=t(a,h,0,1,null,e))}a=g}return a;case "$xor":return D(a,b,d,f,c,e);case "$if":return D(["$xor",a],b,d,f,c,e);case "$call":e=a[1]||{};if(e.view){g=m(e.view,b,d,f,c);h=e.hasOwnProperty("data")?m(e.data,b,d,f,c):b;j=e.hasOwnProperty("index")?m(e.index,b,d,f,c):d;i=e.hasOwnProperty("count")?m(e.count,b,d,f,c):f;b=e.hasOwnProperty("key")?m(e.key,b,d,f,c):c;d={};for(f=a.length-1;2<=f;f--)c=a[f],
e=c[1]||{},e.hasOwnProperty("name")&&(d[e.name]=c);a=g&&l(g.getView)?m(g.getView(),h,j,i,b,d):null}else a=null;return a;case "$part":return g=(a[1]||{}).name||"",g=e&&e.hasOwnProperty(g)?e[g]:a,t(g,b,d,f,c)}g=[g];h=1;for(j=a.length;h<j;h++)s(g,m(a[h],b,d,f,c,e));return B?B(g):g;case 3:e={};for(g in a)a.hasOwnProperty(g)&&(e[g]=m(a[g],b,d,f,c));return e}return a};var F={async:1,autofocus:1,checked:1,defaultchecked:1,defer:1,disabled:1,formnovalidate:1,hidden:1,indeterminate:1,ismap:1,multiple:1,novalidate:1,
readonly:1,required:1,spellcheck:1,willvalidate:1},w=function(a){return"[ "+a+" ]"},r=function(a){if(!l(a)||!l(a.getView)){var b=a;2!==k(b)&&(b=["",b]);a=function(a,f,c,e){try{var g=m(b,a,isFinite(f)?f:0,isFinite(c)?c:1,"string"===typeof e?e:null);return new q(g)}catch(h){return a=w(h),a instanceof q?a:new q(""+a)}};a.getView=function(){return b}}return a};r.onerror=function(a){l(a)&&(w=a)};r.onbind=function(a){l(a)&&(B=a)};r.raw=function(a){return new y(a)};var P={area:!0,base:!0,basefont:!0,br:!0,
col:!0,frame:!0,hr:!0,img:!0,input:!0,isindex:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,wbr:!0};q.prototype.toString=function(){return G(this.value)};q.prototype.write=function(a){(a||n).write(""+this)};var S={accesskey:"accessKey",bgcolor:"bgColor",cellpadding:"cellPadding",cellspacing:"cellSpacing",checked:"defaultChecked","class":"className",colspan:"colSpan",contenteditable:"contentEditable",defaultchecked:"defaultChecked","for":"htmlFor",formnovalidate:"formNoValidate",hidefocus:"hideFocus",
ismap:"isMap",maxlength:"maxLength",novalidate:"noValidate",readonly:"readOnly",rowspan:"rowSpan",spellcheck:"spellCheck",tabindex:"tabIndex",usemap:"useMap",willvalidate:"willValidate"},v={enctype:"encoding",onscroll:"DOMMouseScroll"},T={autocapitalize:1,autocomplete:1,autocorrect:1},Q=/^[\r\n]+/,R=/[\r\n]+$/;q.prototype.toDOM=function(a,b){4===k(a)&&(a=n.getElementById(a));var d;try{b&&(d=a,a=null),d=M(d||u(this.value[0]),this.value)}catch(f){var c=w(f);if(c instanceof q)return c.toDOM(a||d);d=
n.createTextNode(""+c)}a&&a.parentNode&&a.parentNode.replaceChild(d,a);return d};q.prototype.reload=function(){var a=n;try{var b=this.toDOM();a.replaceChild(b,a.documentElement);if(a.createStyleSheet){for(var d=b.firstChild;d&&"HEAD"!==(d.tagName||"");)d=d.nextSibling;for(var f=d&&d.firstChild;f;){if("LINK"===(f.tagName||""))f.href=f.href;f=f.nextSibling}}}catch(c){a=a.open("text/html"),a.write(this.toString()),a.close()}};return r}(document,window.ScriptEngineMajorVersion);
