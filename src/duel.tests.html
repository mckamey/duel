<!DOCTYPE html>
<html>
<head>
	<title>duel.js tests</title>

	<link href="qunit/qunit.css" rel="stylesheet" type="text/css" />
</head>
<body>
	<script src="qunit/qunit.js" type="text/javascript"></script>
	<script src="duel.js" type="text/javascript"></script>

	<h1 id="qunit-header">duel.js tests</h1>  
	<h2 id="qunit-banner"></h2>  
	<h2 id="qunit-userAgent"></h2>  
	<ol id="qunit-tests"></ol> 

	<script type="text/javascript">

	module("Data Binding");

	test("bind() simple", function() {

		var model = {
		        name: "Foo.js",
		        url: "http://example.com/foo.js",
		        size: 5.87,
		        details: "Lorem ipsum dolor sit amet"
		    };

		var view = duel(
			["div", { "class" : "download" },
				["h2",
				 	"Filename: ",
					function(model, index, count) { return model.name; }
				],
				["p",
				 	"URL: ",
				 	["a", { "href" : function(model, index, count) { return model.url; }, "target" : "_blank" },
				 	 	function(model, index, count) { return model.url ;}
				 	],
				 	" (",
				 	function(model, index, count) { return model.size ;},
				 	"KB)"
			 	],
				["p",
				 	"Description: ",
				 	function(model, index, count) { return model.details; }
				]
			]);

		var actual = view.bind(model).toJsonML();

		var expected = 
			["div", { "class" : "download" },
				["h2",
				 	"Filename: Foo.js"
				],
				["p",
				 	"URL: ",
				 	["a", { "href" : "http://example.com/foo.js", "target" : "_blank" },
				 		"http://example.com/foo.js"
			 		],
				 	" (5.87KB)"
			 	],
				["p",
				 	"Description: Lorem ipsum dolor sit amet"
				]
			];

		same(actual, expected, "Binding of simple values.");
	});

	test("bind() simple if", function() {

		var view = duel(
			["",
			 	["$if", { "test" : function(model, index, count) { return model.name === "Example";} },
			 	 	["p", "True: Example === ", function(model, index, count) { return model.name;} ]
			 	],
			 	["$if", { "test" : function(model, index, count) { return model.name !== "Example";} },
			 	 	["p", "False: Example !== ", function(model, index, count) { return model.name;} ]
			 	]
			]);

		var model1 = { name: "Example" };
		var actual1 = view.bind(model1).toJsonML();
		var expected1 = ["", ["p", "True: Example === Example"]];

		same(actual1, expected1, "Binding with simple if statements.");

		var model2 = { name: "Sample" };
		var actual2 = view.bind(model2).toJsonML();
		var expected2 = ["", ["p", "False: Example !== Sample"]];

		same(actual2, expected2, "Binding with simple if statements.");
	});

	test("bind() choose", function() {

		var view = duel(
		 	["$choose",
			 	["$if", {"test":function(model, index, count){return !model.children || !model.children.length;}},
			 	 	["p", "Has no items."]
			 	],
			 	["$if", {"test":function(model, index, count){return model.children && model.children.length === 1;}},
			 	 	["p", "Has only one item."]
			 	],
			 	["$else",
			 	 	["p", "Has ", function(model, index, count){ return model.children.length; }, " items."]
			 	]
		 	]);

		var model1 = { name: "Three", children: [0,2,4] };
		var actual1 = view.bind(model1).toJsonML();
		var expected1 = ["p", "Has 3 items."];

		same(actual1, expected1, "Binding with choose block.");

		var model2 = { name: "One", children: [42] };
		var actual2 = view.bind(model2).toJsonML();
		var expected2 = ["p", "Has only one item."];

		same(actual2, expected2, "Binding with choose block.");

		var model3 = { name: "Zero", children: [] };
		var actual3 = view.bind(model3).toJsonML();
		var expected3 = ["p", "Has no items."];

		same(actual3, expected3, "Binding with choose block.");
	});

	test("bind() loop", function() {

		var model = {
		        title: "This is the title",
		        items: [
		            { name: "One", message: "First!" },
		            { name: "Two", message: "Second." },
		            { name: "Three", message: "Third?" },
		            { name: "Four", message: "Fourth." },
		            { name: "Five", message: "Last!" }
		        ]
		    };

		var view = duel(
			["div", { "class" : "list", "style" : "color:blue" },
				["h2",
				 	function(model, index, count) { return model.title; }
				],
				["ul",
				 	["$for", { "each" : function(model, index, count) { return model.items; } },
						["li", { "class" : "item" },
							["b",
							 	function(model, index, count) { return model.name; }
							],
							": ",
							["i",
							 	function(model, index, count) { return model.message; }
							]
						]
				 	]
				]
			]);

		var actual = view.bind(model).toJsonML();

		var expected =
			["div", { "class" : "list", "style" : "color:blue" },
				["h2", "This is the title"],
				["ul",
					["li", { "class" : "item" },
						["b", "One"],
						": ",
						["i", "First!"]
					],
					["li", { "class" : "item" },
						["b", "Two"],
						": ",
						["i", "Second." ]
					],
					["li", { "class" : "item" },
						["b", "Three"],
						": ",
						["i", "Third?"]
					],
					["li", { "class" : "item" },
						["b", "Four"],
						": ",
						["i", "Fourth."]
					],
					["li", { "class" : "item" },
						["b", "Five"],
						": ",
						["i", "Last!"]
					]
				]
			];

		same(actual, expected, "Binding of looped values.");
	});

	</script>

	<script type="text/javascript">

	module("String Rendering");

	test("toString() simple", function() {

		var model = {
		        name: "Foo.js",
		        url: "http://example.com/foo.js",
		        size: 5.87,
		        details: "Lorem ipsum dolor sit amet"
		    };

		var view = duel(
			["div", { "class" : "download" },
				["h2",
				 	"Filename: ",
					function(model, index, count) { return model.name; }
				],
				["p",
				 	"URL: ",
				 	["a", { "href" : function(model, index, count) { return model.url; }, "target" : "_blank" },
				 	 	function(model, index, count) { return model.url ;}
				 	],
				 	" (",
				 	function(model, index, count) { return model.size ;},
				 	"KB)"
			 	],
				["p",
				 	"Description: ",
				 	function(model, index, count) { return model.details; }
				]
			]);

		var actual = view.bind(model).toString();

		var expected =
			'<div class="download"><h2>Filename: Foo.js</h2>'+
			'<p>URL: <a href="http://example.com/foo.js" target="_blank">http://example.com/foo.js</a> (5.87KB)</p>'+
			'<p>Description: Lorem ipsum dolor sit amet</p>'+
			'</div>';

		same(actual, expected, "Rendering of simple values.");
	});

	test("toString() simple if", function() {

		var view = duel(
			["",
			 	["$if", { "test" : function(model, index, count) { return model.name === "Example";} },
			 	 	["p", "True: Example === ", function(model, index, count) { return model.name;} ]
			 	],
			 	["$if", { "test" : function(model, index, count) { return model.name !== "Example";} },
			 	 	["p", "False: Example !== ", function(model, index, count) { return model.name;} ]
			 	]
			]);

		var model1 = { name: "Example" };
		var actual1 = view.bind(model1).toString();
		var expected1 = '<p>True: Example === Example</p>';

		same(actual1, expected1, "Binding with simple if statements.");

		var model2 = { name: "Sample" };
		var actual2 = view.bind(model2).toString();
		var expected2 = '<p>False: Example !== Sample</p>';

		same(actual2, expected2, "Binding with simple if statements.");
	});

	test("toString() choose", function() {

		var view = duel(
		 	["$choose",
			 	["$if", {"test":function(model, index, count){return !model.children || !model.children.length;}},
			 	 	["p", "Has no items."]
			 	],
			 	["$if", {"test":function(model, index, count){return model.children && model.children.length === 1;}},
			 	 	["p", "Has only one item."]
			 	],
			 	["$else",
			 	 	["p", "Has ", function(model, index, count){ return model.children.length; }, " items."]
			 	]
		 	]);

		var model1 = { name: "Three", children: [0,2,4] };
		var actual1 = view.bind(model1).toString();
		var expected1 = '<p>Has 3 items.</p>';

		same(actual1, expected1, "Rendering with choose block.");

		var model2 = { name: "One", children: [42] };
		var actual2 = view.bind(model2).toString();
		var expected2 = '<p>Has only one item.</p>';

		same(actual2, expected2, "Rendering with choose block.");

		var model3 = { name: "Zero", children: [] };
		var actual3 = view.bind(model3).toString();
		var expected3 = '<p>Has no items.</p>';

		same(actual3, expected3, "Rendering with choose block.");
	});

	test("toString() loop", function() {

		var model = {
		        title: "This is the title",
		        items: [
		            { name: "One", message: "First!" },
		            { name: "Two", message: "Second." },
		            { name: "Three", message: "Third?" },
		            { name: "Four", message: "Fourth." },
		            { name: "Five", message: "Last!" }
		        ]
		    };

		var view = duel(
			["div", { "class" : "list", "style" : "color:blue" },
				["h2",
				 	function(model, index, count) { return model.title; }
				],
				["ul",
				 	["$for", { "each" : function(model, index, count) { return model.items; } },
						["li", { "class" : "item" },
							["b",
							 	function(model, index, count) { return model.name; }
							],
							": ",
							["i",
							 	function(model, index, count) { return model.message; }
							]
						]
				 	]
				]
			]);

		var actual = view.bind(model).toString();

		var expected =
			'<div class="list" style="color:blue">'+
			'<h2>This is the title</h2>'+
			'<ul>'+
			'<li class="item"><b>One</b>: <i>First!</i></li>'+
			'<li class="item"><b>Two</b>: <i>Second.</i></li>'+
			'<li class="item"><b>Three</b>: <i>Third?</i></li>'+
			'<li class="item"><b>Four</b>: <i>Fourth.</i></li>'+
			'<li class="item"><b>Five</b>: <i>Last!</i></li>'+
			'</ul>'+
			'</div>';

		same(actual, expected, "Rendering of looped values.");
	});

	module("DOM Building");

</script>
</body>
</html>